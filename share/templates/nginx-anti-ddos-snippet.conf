# SPDX-License-Identifier: MIT
# Inspired by https://github.com/C0nw0nk/Nginx-Lua-Anti-DDoS
# Include this inside an http{} block (shared dicts) and server/location to protect.

# Shared dictionaries (place inside http { })
lua_shared_dict antiddos 70m;
lua_shared_dict antiddos_blocked 70m;
lua_shared_dict ddos_counter 10m;
lua_shared_dict jspuzzle_tracker 70m;

# Optional: ensure Lua RNG is seeded once.
init_by_lua_block {
    math.randomseed(ngx.now())
}

# Inside the server/location block to protect:
# access_by_lua_file /etc/nginx/sentinelforge/anti_ddos_challenge.lua;
